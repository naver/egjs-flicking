/*
Copyright (c) 2017 NAVER Corp.
@egjs/flicking JavaScript library
@egjs/flicking project is licensed under the MIT license

https://github.com/naver/egjs-flicking
@version 3.0.0-dev
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@egjs/component"),require("@egjs/axes")):"function"==typeof define&&define.amd?define(["@egjs/component","@egjs/axes"],e):((t=t||self).eg=t.eg||{},t.eg.Flicking=e(t.eg.Component,t.eg.Axes))}(this,function(t,h){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function l(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.forEach(function(n){Object.keys(n).forEach(function(t){var e=n[t];i[t]=e})}),i}var a=function(){var t={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",OTransform:"-o-transform",transform:"transform"},e=document.documentElement.style,n="";for(var i in t)i in e&&(n=i);if(!n)throw new Error("Browser doesn't support CSS3 2D Transforms.");var o=document.createElement("div");document.documentElement.insertBefore(o,null),o.style[n]="translate3d(1px, 1px, 1px)";var r=window.getComputedStyle(o).getPropertyValue(t[n]);o.parentElement.removeChild(o);var s={name:n,has3d:0<r.length&&"none"!==r};return a=function(){return s},s};function s(e,n){Object.keys(n).forEach(function(t){e.style[t]=n[t]})}function v(t,e,n){return Math.max(Math.min(t,n),e)}function c(t,e,n){return e<=t&&t<n}function u(t,e,n){var i=null!=n?n:e/2,o=/(?:(\+|\-)\s*)?(\d+(?:\.\d+)?(%|px)?)/g;if("number"==typeof t)return v(t,0,e);for(var r=0,s=0,a=o.exec(t);null!=a;){var l=a[1],h=a[2],c=a[3],u=parseFloat(h);if(r<=0&&(l=l||"+"),!l)return i;"%"===c&&(u=u/100*e),s+="+"===l?u:-u,++r,a=o.exec(t)}return 0===r?i:v(s,0,e)}var d={classPrefix:"eg-flick",deceleration:6e-4,horizontal:!0,circular:!1,threshold:40,duration:100,panelEffect:function(t){return 1-Math.pow(1-t,3)},defaultIndex:0,inputType:["touch","mouse"],thresholdAngle:45,bounce:10,adaptive:!1,zIndex:2e3,bound:!1,overflow:!1,hanger:"50%",anchor:"50%"},w="IDLE",p="HOLDING",T="DRAGGING",y="MOVING",I="DISABLED",n={options:d,currentPanelIndex:d.defaultIndex,movingDirection:void 0,movingState:w,moveStartTriggered:!1,lastHoldingDelta:0},o={position:"relative",zIndex:d.zIndex,width:"100%",height:"100%",willChange:"transform",overflow:"hidden"},r={width:"100%",height:"100%"},g={position:"absolute"},b={HOLD_START:"holdStart",HOLD_END:"holdEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",CHANGE:"change",RESTORE:"restore",SELECT:"select"},z={PREV:"PREV",NEXT:"NEXT"},f=a(),P=function(){function o(t,e,n,i){var o,r;this.element=t,this.viewport=n,this.state={index:e,horizontal:i.horizontal,position:0,anchorExpression:i.anchorExpression,relativeAnchorPosition:0,size:0,clonedPanels:[],isClone:!1,originalStyle:{className:t.getAttribute("class")||null,style:t.getAttribute("style")||null},cachedBbox:null},i.classPrefix&&(o=t,r=i.classPrefix+"-panel",o.classList?o.classList.add(r):o.className.indexOf(r)<0&&(o.className=(o.className+" "+r).replace(/\s{2,}/g," "))),s(this.element,g),this.resize()}var t=o.prototype;return t.update=function(t){var e=this.state;e.isClone?this.original.update(t):[this.element].concat(e.clonedPanels.map(function(t){return t.element})).forEach(t)},t.resize=function(){var t=this.state;t.cachedBbox=null;var e=this.getBbox();t.size=t.horizontal?e.width:e.height},t.destroy=function(){var t=this.element,e=this.state.originalStyle;for(var n in e.className?t.setAttribute("class",e.className):t.removeAttribute("class"),e.style?t.setAttribute("style",e.style):t.removeAttribute("style"),this)this[n]=null},t.getElement=function(){return this.element},t.getAnchorPosition=function(){return this.state.position+this.state.relativeAnchorPosition},t.getRelativeAnchorPosition=function(){return this.state.relativeAnchorPosition},t.getIndex=function(){return this.state.index},t.getPosition=function(){return this.state.position},t.getSize=function(){return this.state.size},t.getPrevPanel=function(){return this.prevPanel},t.getNextPanel=function(){return this.nextPanel},t.getBbox=function(){var t=this.state;return t.cachedBbox||(t.cachedBbox=this.element.getBoundingClientRect()),t.cachedBbox},t.isClone=function(){return this.state.isClone},t.getIdenticalPanels=function(){var t=this.state;return t.isClone?this.original.getIdenticalPanels():[this].concat(t.clonedPanels)},t.setPosition=function(t){var e=this.state,n=this.element.style;e.position=t,e.horizontal?n.left=t+"px":n.top=t+"px",e.relativeAnchorPosition=u(e.anchorExpression,e.size)},t.setPrevPanel=function(t){this.prevPanel=t},t.setNextPanel=function(t){this.nextPanel=t},t.clone=function(){var t=this.state,e=this.viewport,n=this.element.cloneNode(!0),i=new o(n,t.index,e,{anchorExpression:t.anchorExpression,horizontal:t.horizontal});return i.original=this,i.state.isClone=!0,i.state.size=t.size,e.appendPanelElement(n),t.clonedPanels.push(i),i},t.toReadonlyVersion=function(){var s=this.state,a=this;return{element:this.element,index:s.index,position:s.position,anchorPosition:s.position+s.relativeAnchorPosition,size:s.size,focus:function(t){var e=a.viewport,n=e.flicking,i=e.getCameraPosition()+e.getHangerPosition(),o=s.position+s.relativeAnchorPosition;if(i!==o){var r=o<i?z.PREV:z.NEXT;n.trigger(b.CHANGE,{index:this.index,panel:this,direction:r,prevIndex:e.getIndex(),prevPanel:e.getCurrentPanel().toReadonlyVersion(),isTrusted:!1})||(a.viewport.moveTo(this,null,t),null!=t&&t<=0&&n.trigger(b.MOVE_END,{direction:r,isTrusted:!1}))}},update:this.update.bind(this),prev:function(){var t=a.prevPanel;if(null==t)return null;var e=t.toReadonlyVersion();if(this.position<e.position){for(var n=e.position,i=a.viewport.getScrollArea(),o=i.next-i.prev;n-=o,this.position<n;);return l({},e,{position:n,anchorPosition:n+t.state.relativeAnchorPosition})}return e},next:function(){var t=a.nextPanel;if(null==t)return null;var e=t.toReadonlyVersion();if(this.position>e.position){for(var n=e.position,i=a.viewport.getScrollArea(),o=i.next-i.prev;n+=o,this.position>n;);return l({},e,{position:n,anchorPosition:n+t.state.relativeAnchorPosition})}return e}}},o}(),m=function(){function t(t,e,n){this.viewportElement=t,this.cameraElement=e,this.state={index:n.defaultIndex,size:-1,position:0,hangerPosition:0,scrollArea:{prev:-1,next:-1},translate:f,options:n},this.build()}var e=t.prototype;return e.moveTo=function(t,e,n){void 0===n&&(n=this.state.options.duration);var i=this.state,o=t.anchorPosition-i.hangerPosition;o=this.canSetBoundMode()?v(o,i.scrollArea.prev,i.scrollArea.next):o,i.index=t.index,e?e.setTo({flick:o},n):this.axes.setTo({flick:o},n)},e.moveCamera=function(t){var e=this.state;t=Math.round(t);var n=e.translate.name,i=(e.options.horizontal?[-t,0]:[0,-t]).map(function(t){return t+"px"}).join(", ");this.cameraElement.style[n]=e.translate.has3d?"translate3d("+i+", 0px)":"translate("+i+")",e.position=t},e.resize=function(){var t=this.viewportElement.getBoundingClientRect(),e=this.state,n=e.options,i=this.panels;i.forEach(function(t){return t.resize()}),this.adjustSize(),e.size=e.options.horizontal?t.width:t.height,e.hangerPosition=u(n.hanger,e.size);var o=i[0],r=i[i.length-1],s=e.hangerPosition;this.canSetBoundMode()?e.scrollArea={prev:o.getPosition(),next:r.getPosition()+r.getSize()-e.size}:e.scrollArea={prev:o.getAnchorPosition()-s,next:r.getAnchorPosition()-s}},e.findNearestPanel=function(){var t=this.state,e=t.scrollArea,n=t.position+t.hangerPosition;if(this.isOutOfBound())return t.position<e.prev?this.panels[0]:this.panels[this.panels.length-1];for(var i=0,o=this.panels.concat(this.clonedPanels);i<o.length;i++){var r=o[i],s=r.getPosition();if(c(n,s,s+r.getSize()))return r}},e.findPanelOf=function(t){for(var e=0,n=this.panels.concat(this.clonedPanels);e<n.length;e++){var i=n[e];if(i.getElement().contains(t))return i}},e.findNearestIdenticalPanel=function(t){var e=this.state,i=t,o=1/0,r=e.position+e.hangerPosition;return t.getIdenticalPanels().forEach(function(t){var e=t.getAnchorPosition(),n=Math.abs(e-r);n<o&&(i=t,o=n)}),i},e.findShortestPositionToPanel=function(t){var e=this.state,n=e.options,i=t.getAnchorPosition(),o=Math.abs(e.position+e.hangerPosition-i),r=e.scrollArea.next-e.scrollArea.prev;if(n.circular)return o<=r-o?i-e.hangerPosition:i>e.position+e.hangerPosition?i-e.hangerPosition-r:i-e.hangerPosition+r;var s=i-e.hangerPosition;return this.canSetBoundMode()?v(s,e.scrollArea.prev,e.scrollArea.next):s},e.enable=function(){this.panInput.enable()},e.disable=function(){this.panInput.disable()},e.adjustSize=function(){var t,e=this.state.options,i=e.horizontal;if(e.adaptive){var n=this.getCurrentPanel().getBbox();t=i?n.height:n.width}else{t=this.panels.reduce(function(t,e){var n=e.getBbox();return Math.max(t,i?n.height:n.width)},0)}var o=this.viewportElement.style;i?(o.height=t+"px",o.minHeight="100%"):(o.width=t+"px",o.minWidth="100%")},e.destroy=function(){var t=this.viewportElement,e=t.parentElement;for(var n in e.removeChild(t),this.axes.destroy(),this.panInput.destroy(),this.panels.forEach(function(t){e.appendChild(t.getElement()),t.destroy()}),this)this[n]=null},e.getPanelCount=function(){return this.panels.length},e.getPanel=function(t){return c(t,0,this.panels.length)?this.panels[t]:null},e.getCurrentPanel=function(){return this.panels[this.state.index]},e.getIndex=function(){return this.state.index},e.getPrevIndex=function(){var t=this.state,e=t.index-1;return e<0&&(e=t.options.circular?this.panels.length-1:-1),e},e.getNextIndex=function(){var t=this.state,e=t.index+1;return e>=this.panels.length&&(e=t.options.circular?0:-1),e},e.getSize=function(){return this.state.size},e.getScrollArea=function(){return this.state.scrollArea},e.getHangerPosition=function(){return this.state.hangerPosition},e.getCameraPosition=function(){return this.state.position},e.connectAxesHandler=function(t){var e=this.state.options.horizontal;return this.axes.on(t).connect(e?["flick",""]:["","flick"],this.panInput)},e.appendPanelElement=function(t){this.cameraElement.appendChild(t)},e.build=function(){this.applyCSSValue(),this.placePanels(),this.resize(),this.state.options.circular&&(this.clonePanels(),this.replacePanels()),this.chainPanels(),this.setAxesInstance(),this.moveToDefaultPanel()},e.applyCSSValue=function(){var t=this.state.options,e=this.viewportElement,n=this.cameraElement,i=t.classPrefix;e.className=i+"-viewport",n.className=i+"-camera",s(e,o),s(n,r),t.zIndex&&(e.style.zIndex=""+t.zIndex),t.overflow&&(e.style.overflow="visible")},e.placePanels=function(){var t,n=this,i=this.state.options,e=this.cameraElement.children;if(!e||!e.length)throw new Error("There're no panel elements.");this.panels=(t=e,[].slice.call(t)).map(function(t,e){return new P(t,e,n,{horizontal:i.horizontal,classPrefix:i.classPrefix,anchorExpression:i.anchor})}),this.clonedPanels=[];var o=0;this.panels.forEach(function(t){var e=o,n=t.getSize();t.setPosition(e),o+=n})},e.clonePanels=function(){var t=this.state,e=this.panels,o=this.clonedPanels,n=t.size,i=e[e.length-1],r=i.getPosition()+i.getSize();t.scrollArea={prev:t.scrollArea.prev,next:r+e[0].getRelativeAnchorPosition()-t.hangerPosition};for(var s=t.scrollArea,a=s.next+n-s.prev,l=r,h=function(){var i=l;e.forEach(function(t){var e=i+t.getPosition(),n=t.clone();n.setPosition(e),o.push(n)}),l+=r};h(),l<=a;);},e.replacePanels=function(){for(var t=this.state,e=this.panels,n=this.clonedPanels,i=t.scrollArea.next+t.size,o=e[0].getPosition(),r=0,s=n.concat().reverse();r<s.length;r++){var a=s[r],l=a.getPosition(),h=o-a.getSize();if(l<=i)break;a.setPosition(h),o=h}},e.chainPanels=function(){var o=this.panels.concat(this.clonedPanels);if(o.forEach(function(t,e){var n=0<e?o[e-1]:null,i=e<o.length-1?o[e+1]:null;t.setPrevPanel(n),t.setNextPanel(i)}),this.state.options.circular){var t=o[0],e=o[o.length-1];t.setPrevPanel(e),e.setNextPanel(t)}},e.setAxesInstance=function(){var t,e=this.state,n=e.options,i=e.scrollArea,o=e.size,r=n.horizontal,s=n.bounce,a=s;if((t=s)&&t.constructor===Array)a=s.map(function(t){return u(t,o,d.bounce)});else{var l=u(s,o,d.bounce);a=[l,l]}this.axes=new h({flick:{range:[i.prev,i.next],circular:n.circular,bounce:a}},{easing:n.panelEffect,deceleration:n.deceleration,interruptable:!0}),this.panInput=new h.PanInput(this.viewportElement,{inputType:n.inputType,thresholdAngle:n.thresholdAngle,scale:r?[-1,0]:[0,-1]})},e.moveToDefaultPanel=function(){var t=this.state,e=v(t.options.defaultIndex,0,this.panels.length-1),n=this.panels[e],i=this.findShortestPositionToPanel(n);t.index=e,this.moveCamera(i),this.axes.setTo({flick:i},0)},e.isOutOfBound=function(){var t=this.state,e=t.scrollArea;return!t.options.circular&&(t.position<e.prev||t.position>e.next)},e.canSetBoundMode=function(){var t=this.state,e=t.options,n=this.panels,i=n[n.length-1],o=i.getPosition()+i.getSize();return e.bound&&!e.circular&&o>=t.size},t}();return function(r){function t(t,e){void 0===e&&(e={});var n,i=r.call(this)||this;if("string"==typeof t){if(!(n=document.querySelector(t)))throw new Error("Base element doesn't exist.")}else{if(!t.nodeName||1!==t.nodeType)throw new Error("Element should be provided in string or HTMLElement.");n=t}return i.wrapper=n,i.build(e),i}!function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,r);var e=t.prototype;return e.prev=function(t){var e=this.viewport.getCurrentPanel().getPrevPanel();return e&&this.moveToPanelProgramatic(e,t),this},e.next=function(t){var e=this.viewport.getCurrentPanel().getNextPanel();return e&&this.moveToPanelProgramatic(e,t),this},e.moveTo=function(t,e){var n=this.viewport.getPanel(t);return n&&this.moveToPanelProgramatic(n,e),this},e.getIndex=function(){return this.viewport.getIndex()},e.getPrevIndex=function(){return this.viewport.getPrevIndex()},e.getNextIndex=function(){return this.viewport.getNextIndex()},e.getCurrentPanel=function(){return this.viewport.getCurrentPanel().toReadonlyVersion()},e.getPanel=function(t){var e=this.viewport.getPanel(t);return e?e.toReadonlyVersion():null},e.getPanelCount=function(){return this.viewport.getPanelCount()},e.isPlaying=function(){return this.state.movingState!==w},e.enableInput=function(){return this.viewport.enable(),this},e.disableInput=function(){return this.viewport.disable(),this},e.destroy=function(){for(var t in this.off(),this.viewport.destroy(),this)this[t]=null},e.trigger=function(t,e){void 0===e&&(e={});var n=this.state,i=n.movingState===p||n.movingState===T,o=this.viewport.getCurrentPanel();return e.direction&&(n.movingDirection=e.direction),t===b.MOVE_END&&(n.moveStartTriggered=!1,n.options.adaptive&&this.viewport.adjustSize()),!r.prototype.trigger.call(this,t,l({type:t,index:o.getIndex(),panel:o.toReadonlyVersion(),holding:i},e))},e.build=function(t){this.setInitialState(t),this.initViewport(),this.listenInput()},e.setInitialState=function(t){var e=l({},n);e.options=l({},d,t),this.state=e},e.initViewport=function(){var t=this.wrapper,e=this.state.options,n=t.children;if(!n||!n.length)throw new Error("Given base element doesn't have proper DOM structure to be initialized.");for(var i=document.createElement("div"),o=t.firstChild;o;)i.appendChild(o),o=t.firstChild;var r=document.createElement("div");r.appendChild(i),t.appendChild(r),this.viewport=new m(r,i,e);var s=this.viewport;s.flicking=this,e.defaultIndex=v(e.defaultIndex,0,s.getPanelCount()-1)},e.listenInput=function(){this.viewport.connectAxesHandler({hold:this.onAxesHold.bind(this),change:this.onAxesChange.bind(this),release:this.onAxesRelease.bind(this),animationEnd:this.onAxesAnimationEnd.bind(this),finish:this.onAxesFinish.bind(this)})},e.stopMoving=function(){var t=this.state;t.panelMovingTo=void 0,t.movingState=w,t.movingDirection=void 0,t.lastHoldingDelta=0},e.onAxesHold=function(t){var e=this.state;e.movingState!==I&&(this.trigger(b.HOLD_START,{axesEvent:t,holding:!0,isTrusted:!0})?e.movingState=I:(e.movingState=e.movingState!==y?p:T,e.movingDirection=void 0,e.lastHoldingDelta=0))},e.onAxesChange=function(t){var e=this.state,n=this.viewport,i=t.pos.flick,o=t.inputEvent?e.options.horizontal?t.inputEvent.deltaX:t.inputEvent.deltaY:0;if(e.movingState!==I&&t.delta.flick){var r=o<e.lastHoldingDelta?z.NEXT:z.PREV;if(!e.moveStartTriggered){if(e.moveStartTriggered=!0,this.trigger(b.MOVE_START,{axesEvent:t,direction:e.movingState===p?r:e.movingDirection,isTrusted:t.isTrusted}))return this.stopMoving(),void(e.movingState=I);e.movingState=e.movingState===p?T:e.movingState}e.movingState===T&&(e.movingDirection=r,e.lastHoldingDelta=o);var s=this.viewport.getCameraPosition();return n.moveCamera(i),this.trigger(b.MOVE,{axesEvent:t,direction:e.movingDirection,isTrusted:t.isTrusted})?(n.moveCamera(s),this.stopMoving(),void(e.movingState=I)):void 0}},e.onAxesRelease=function(t){var e=this.state,n=e.options,i=this.viewport;if(e.movingState!==I){var o=n.horizontal?t.inputEvent.deltaX:t.inputEvent.deltaY,r=o<0,s=Math.abs(o),a=t.inputEvent.deltaX?Math.abs(180*Math.atan(t.inputEvent.deltaY/t.inputEvent.deltaX)/Math.PI):90,l=i.getCurrentPanel(),h=e.movingState===T,c=s>=n.threshold&&(n.horizontal?a<=n.thresholdAngle:a>n.thresholdAngle);if(e.movingState=y,this.trigger(b.HOLD_END,{axesEvent:t,holding:!1,direction:e.movingDirection,isTrusted:!0}),!c){if(!h){var u=i.getCameraPosition(),v=t.inputEvent.srcEvent.target,d=i.findPanelOf(v);if(d){var p=d.getPosition(),g=u<p?z.NEXT:p<u?z.PREV:void 0;e.movingState=w,this.trigger(b.SELECT,{axesEvent:t,direction:g,isTrusted:!0,selectedIndex:d.getIndex(),selectedPanel:d.toReadonlyVersion()})}else t.setTo({flick:u},0),this.stopMoving();return}if(e.panelMovingTo)return void this.viewport.moveTo(e.panelMovingTo.toReadonlyVersion(),t)}var f=r?l.getSize()-l.getRelativeAnchorPosition():l.getRelativeAnchorPosition();f=Math.max(f,n.threshold);var P=i.getCameraPosition()+i.getHangerPosition(),m=l;if(c)if(s<=f){var x=r?l.getNextPanel():l.getPrevPanel();if(n.circular){var E=l.getIdenticalPanels()[1];(A=Math.abs(l.getAnchorPosition()-P)>Math.abs(E.getAnchorPosition()-P))&&(x=r?E.getNextPanel():E.getPrevPanel())}m=null!=x?x:l}else m=i.findNearestPanel();else if(n.circular){E=l.getIdenticalPanels()[1];var A=Math.abs(l.getAnchorPosition()-P)>Math.abs(E.getAnchorPosition()-P);!r&&A&&(m=E)}var S=c?b.CHANGE:b.RESTORE;if(c&&!n.circular&&m===l&&(S=b.RESTORE),this.trigger(S,{index:m.getIndex(),panel:m.toReadonlyVersion(),prevIndex:S===b.CHANGE?l.getIndex():void 0,prevPanel:S===b.CHANGE?l.toReadonlyVersion():void 0,axesEvent:t,direction:e.movingDirection,isTrusted:!0}))return this.stopMoving(),void(e.movingState=I);e.panelMovingTo=m,this.viewport.moveTo(m.toReadonlyVersion(),t)}},e.onAxesAnimationEnd=function(t){var e=this.state;e.movingState!==I&&this.trigger(b.MOVE_END,{axesEvent:t,direction:e.movingDirection,isTrusted:t.isTrusted})},e.onAxesFinish=function(t){this.stopMoving()},e.moveToPanelProgramatic=function(t,e){void 0===e&&(e=this.state.options.duration);var n=this.state,i=this.viewport,o=i.getIndex();if(t&&n.movingState===w&&t.getIndex()!==o){var r=i.findShortestPositionToPanel(t),s=i.getCameraPosition(),a=s<r?z.NEXT:r<s?z.PREV:void 0;if(this.state.movingState=y,this.state.movingDirection=a,!this.trigger(b.CHANGE,{index:t.getIndex(),panel:t.toReadonlyVersion(),prevIndex:i.getIndex(),prevPanel:i.getCurrentPanel().toReadonlyVersion(),direction:a,isTrusted:!1})){var l=i.findNearestIdenticalPanel(t);this.viewport.moveTo(l.toReadonlyVersion(),null,e),e<=0&&(this.trigger(b.MOVE_END,{direction:a,isTrusted:!1}),this.stopMoving())}}},t.VERSION="3.0.0-dev",t.DIRECTION=z,t.EVENTS=b,t}(t)});
//# sourceMappingURL=flicking.min.js.map
